@using PW.Ncels.Database.DataModel
@model Guid?

<div style="margin-left: 10px; margin-right: 60px; width: 90%" class="pwPage pwPageEx">
    <div class="panel-body">
        <div class="row">
            <div class="col-lg-6">
                <label>Акт отбора</label>
                <table class="table table-striped table-bordered table-hover dataTable">
                    <thead>
                        <tr>
                            <th>№ акта отбора </th>
                            <th>Дата отбора</th>
                            <th>Эксперт проводивший отбор</th>
                        </tr>
                    </thead>
                    <tbody id="@("act-Table" + Model)"></tbody>
                </table>
            </div>
            <div class="col-lg-6">
                <div class="row" style="margin-top: 25px;">
                    <div class="col-lg-12">
                        <a href="#" onclick="editActReception(event)" id="editActReceptionBtn" class="k-button" style="background-color: #0066cc; color: white;font-weight: 700; margin-left: 20px; width: 120px;">Изменить</a>
                        <a href="#" onclick="deleteActReception(event)" id="deleteActReceptionBtn" class="k-button" style="background-color: #0066cc; color: white;font-weight: 700; margin-left: 20px; width: 120px;">Удалить</a>
                        <a href="/SafetyAssessment/PrintActReception?contractId=@ViewData["ContractId"]&actReceptionId=@Model&view=false" id="printActReceptionBtn" class="k-button" style="background-color: #0066cc; color: white;font-weight: 700; margin-left: 20px; width: 120px;">Печать</a>
                        <a href="#" onclick="viewActReception(event)" id="viewActReceptionBtn" class="k-button" style="background-color: #0066cc; color: white;font-weight: 700; margin-left: 20px; width: 120px;">Просмотр</a>
                        <a href="#" onclick="addActReception(event)" id="addActReception" class="k-button" style="background-color: #0066cc; color: white;font-weight: 700; margin-left: 20px; width: 120px;">Добавить</a>
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" value="@Model" id="ActReceptionId">
    </div>
</div>

<div id="windowFrame">

</div>

<div id="@("modal" + Model)" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="width:1200px;">

        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Акт отбора</h4>
            </div>
            <div class="modal-body" id="@("modal-body" + Model)">

            </div>
        </div>

    </div>
</div>

<script>

    $(document).ready(function ()
    {
        getSerialActs();
    })

    if('@Model' == '@Guid.Empty'){
        $("#deleteActReceptionBtn").hide();
        $("#printActReceptionBtn").hide();
        $("#viewActReceptionBtn").hide();
    }


    function initPrintWindow(_actReceptionId) {
        $.ajax({
            type: 'POST',
            url: '/SafetyAssessment/ActTemplate/',
            data: { actReceptionId: _actReceptionId },
            success: function (data) {
                $("#windowFrame").html(data);
            }
        });
    }

    function editActReception() {
        $.ajax({
            type : 'POST',
            url : '/SafetyAssessment/ExpertActData/',
            data : { assessmentId: '@ViewData["AssessmentDeclarationId"]' },
            success: function (result) {
                $("#act-data").html(result);
                $("#act-data").css('border-style', 'groove');
                $("#editActReceptionBtn").hide();
                $("#deleteActReceptionBtn").hide();
                $("#printActReceptionBtn").hide();
                $("#viewActReceptionBtn").hide();
            }

        });
    }

    function addActReception()
    {
        $.ajax({
            type : 'POST',
            url : '/SafetyAssessment/SerialActData/',
            data : { assessmentId: '@ViewData["AssessmentDeclarationId"]' },
            success: function (result) {
                $("#modal-body" + "@Model").html(result);
                $("#modal" + "@Model").modal("show");
                $("#editActReceptionBtn").hide();
                $("#deleteActReceptionBtn").hide();
                $("#printActReceptionBtn").hide();
                $("#viewActReceptionBtn").hide();
            }

        });
    }


    function showReport(content) {
        var modal = $("#modal_view");
        modal.find(".modal-body").html(content).end()
            .modal({ backdrop: 'static', keyboard: false })
            .on('hidden.bs.modal', function () {
                modal.unbind();
            });
    }
    function deleteActReception(){
        $.ajax({
            type : 'POST',
            url : '/SafetyAssessment/DeleteExpertActReception/',
            data: { actReceptionId: '@Model' },
            success: function (result) {
                $("#act-data").html("");
                $("#editActReceptionBtn").show();
                $("#deleteActReceptionBtn").hide();
                $("#printActReceptionBtn").hide();
                $("#viewActReceptionBtn").hide();
                $("#ModelNumber").html("");
                $("#ModelActDate").html("");
                $("#ModelWorker").html("");
            }
        });
    }

    function viewActReception() {
        initPrintWindow($("#ActReceptionId").val());
    }

    function getSerialActs()
    {
        $.ajax({
            type: 'POST',
            url: '/SafetyAssessment/GetSerialActs',
            data: { assessmentId: '@ViewData["AssessmentDeclarationId"]' },
            success: function (data)
            {
                $("#act-Table" + "@Model").html("");
                if (data.success == true){
                    if (data.result != null && data.result.length != 0){
                        for (var i = 0; i < data.result.length; i++)
                        {
                            var content = "<tr> <td>" + data.result[i].Number + "</td><td> " + data.result[i].ActDate
                                + "</td><td>" + data.result[i].Worker + "</td></tr>"
                            $("#act-Table" + "@Model").append(content);

                        }
                    }
                }
            }
        });
    }

</script>






