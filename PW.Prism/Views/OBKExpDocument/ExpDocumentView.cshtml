@using PW.Ncels.Database.DataModel
@model PW.Ncels.Database.DataModel.OBK_AssessmentDeclaration


<div class="panel-body">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-body" id="productExpertiseId">
                    <div class="row" style="margin-bottom: 10px">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-lg-6">
                                    <label class="control-label">Результат</label>
                                    @Html.DropDownList("ExpertiseResult", (IEnumerable<SelectListItem>)ViewData["UObkExpertiseResult"],
         String.Empty, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-4" style="margin: 10px;">
                                    <label class="control-label"> </label>
                                    <button type="button" style="margin: 10px" class="btn btn-default" onclick="saveExpDoc()">Сохранить</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="selectionPlaceDiv" style="display:none;">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row" style="margin-bottom: 10px">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-lg-3">
                                    <label class="control-label">Дата отбора</label>
                                    <input id="datePicker" title="datepicker" style="width: 100%" />
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-3">
                                    <label class="control-label">Время отбора</label>
                                    <input id="timePicker" title="datepicker" style="width: 100%" />
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-6">
                                    <label class="control-label">Место отбора</label>
                                    <br>
                                    <textarea id="addressSelection" rows="4" cols="50"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col-lg-offset-9">
                            <a href="#" onclick="sendSelectionPlace(event)" class="k-button" style="background-color: #0066cc; width:250px; color: white;font-weight: 700;">Отправить уведомление заявителю</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



</div>

<script type="text/javascript">
                        debugger;
    function initSelectionPlace() {
        if ('@ViewData["selectionPlace"]' != "") {
            $("#addressSelection").val('@ViewData["selectionPlace"]');
        }

        if ('@ViewData["selectionDate"]' != "") {
            $("#datePicker").kendoDatePicker({ value: '@ViewData["selectionDate"]' });
        } else {
            $("#datePicker").kendoDatePicker();
        }

        if ('@ViewData["selectionTime"]' != "") {
        $("#timePicker").kendoTimePicker({
            dateInput: true,
            value: '@ViewData["selectionTime"]',
            format: "HH:mm"
            });
        } else {
            $("#timePicker").kendoTimePicker({
            dateInput: true,
            });
        }

        $("#selectionPlaceDiv").css('display', 'inline');

    }


    if ('@Model.ApplicantAgreement' == 'True') {

        initSelectionPlace();
    }


    function saveExpDoc() {
        debugger;
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SaveExpDocument")',
            data: { expResult: $("#ExpertiseResult").val(), modelId: '@Model.Id' },
            cache: false,
            success: function (result) {
                if (result.isSuccess) {
                    if('@Model.OBKApplicantParty' == 'True'){
                    initSelectionPlace();
                    }
                } else { alert("Error!"); }
            },
            error: function () {
                alert("Connection Failed. Please Try Again");
            }
        });
    };

    function sendSelectionPlace() {

        $.ajax({
            type: 'POST',
            url: '/OBKExpDocument/SaveSelectionPlace',
            data: {
                    selectionDate: $("#datePicker").val(),
                    selectionTime: $("#timePicker").val(),
                    selectionAddress: $("#addressSelection").val(),
                    assessmentId:' @Model.Id'
            },
            success: function (result) {
                console.log(result);
            },
            error: function () {
                alert("Connection Failed. Please Try Again");
            }

        });
    };

</script>
